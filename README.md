### Взлом программы
## 1.Задание
Задание выполнялось в парах, каждый написал программу на ассемблере, предназначенную для взлома напарником, и кряк на Си, осуществляющий взлом.
## Программа для взлома
Я написал программу на ассемблере , в которой пользователь должен ввести пароль , если пароль верный , то ему разрешается доступ.
У меня есть два вида пользователя : обычный пользователь и админ. Если пользователь ввёл пароль и он не совпал с пользовательским , дальше идёт защищённая проверка на админовский пароль.
## BINPATCH
Я написал программу на си (бинарный патч) , которая открывает бинарный файл и меняет определённые байты так , чтобы любой введённый пароль разрешал доступ.
## 2.Мои уязвимости
# Простая уязвимость
Я расположил буфер ввода пароля прямо в функции сравнения паролей и также я не проверяю длину введённого пароля , что позволяет переполнением буфера изменить адрес прыжка после их сравнения.
В следстиве чего , при любом введённом пароле доступ будет разрешён.


```c
Compare:
    mov Compare_Result , 1

Compare_Loop:
    mov al , [si]
    cmp al , [di]
    jmp Overflove_Part

    InputBuffer  db 10             ; Максимальная длина ввода
    InputLength  db 0              ; Фактическая длина введённого пароля
    Input        db 10 dup (0)

Overflove_Part:

    jne Not_Equal_Password
    test al , al
    je Equal_Password
    inc si
    inc di
    jmp Compare_Loop


Not_Equal_Password:
    mov Compare_Result , 0

Equal_Password:
    ret
```
Вот пример переполнения буфера
![GitHub](https://github.com/Arseny-Dernovich/crack/blob/main/README/1_vulnerability.png)

# Сложная уязвимость
Вторая уязвимость связана с функцией проверки на админовский пароль. В этой функции у меня стоит проверку на хэш-сумму определённой части кода , но эта часть кода , которая хэшируется , не затригавет этй функцию , что даёт возможность
изменять эту функцию , не боясь не пройти проверку. Необходимо изменить эту функцию через бинарный патч , поменяв после функции проверки **jne Wrong** на **je Wrong** , что позволит любому введённому паролю стать админовским.

```c
Admin_Access:

    xor ax , ax
    mov Hash_Sum_1 , ax

    lea si , start
    mov cx , Wrong - start
    call Calculate_Hash_Of_Part_Code


    cmp ax , [True_Hash_sum_1]
    jne Block_User  ; Если хэши не совпали — данные изменены

    lea si , Admin_Password
    lea di , Input
    call Compare
    cmp Compare_Result , 1
    jne Wrong

    lea dx , Msg_Admin_Pass
    mov ah , 09h
    int 21h

    jmp Exit
```
## Вот что произойдёт
![Github](https://github.com/Arseny-Dernovich/crack/blob/main/README/photo_2025-03-09_17-31-56.jpg)
![Github](https://github.com/71frukt/CRACK/blob/main/readme/access_2_proof.png)
## 3.Поиск уязвимостей у напарника
## Простая уязвимость
Продизассемблировав бинарный файл , который мне дал напарник , я понял что он считает у введённого пароля хэш-сумму и потом сравнивает её с определённым числом.
Буфер для пароля  у него лежит перед значением эталонной хэш-суммы , судя по бинарному файлу и поэтому можно перезатереть значение хэш-суммы на своё.


![Github](https://github.com/Arseny-Dernovich/crack/blob/main/README/Снимок%20экрана%202025-03-09%20174614.png)
## Вот что произойдёт
![Github](https://github.com/71frukt/CRACK/blob/main/readme/pswd_myprog.png)

Числа после '$' не будут влиять на хеш, а последовательность байт **A0C4**, затирающая значение верного хеш-кода, соответствует хеш-коду пустого пароля (начинающегося с '$').

## Сложная уязвимсоть
Вторая уязвимость связана также с переполнением буфера. Я придумал , что можно создать такой пароль , который переполнением перезатрёт адрес возврата из функции.
Через turbodebugger  я определил какой длины мне нужен пароль , где находится старый адрес возврата  и на какой адрес возврата мне надо заменить.

![Github](https://github.com/71frukt/CRACK/blob/main/readme/get_access_proof.png)

## Графика
Чтобы разнообразить программу от обычного кода , я добавил графический интерфейс в виде видео с широко известным на Физтехе "самым халявным экзаменатором" и конечно же это Е.Умнов .

![Умнов улетает на Гаити](https://github.com/Arseny-Dernovich/crack/blob/main/README/Запись%20экрана%202025-03-09%20181226.mp4)








